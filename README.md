# L/R Master

L/R Master は、日本人英語学習者にとって最も困難とされる「L」と「R」の発音・聞き分けを克服するために開発された、AI搭載型のWebアプリケーションです。

Google Gemini、OpenAI (Whisper + GPT)、またはブラウザ標準の音声認識を選択して利用可能で、Web Audio APIによる「声紋（スペクトログラム）」の可視化機能も搭載しています。

## 🎯 主な特徴

- **AIによる発音判定**: 100点満点のスコアリングと具体的なアドバイス
- **2つの学習モード**: 発音練習モードと聞き取り練習モード
- **音声可視化**: 波形・声紋・スペクトルで発音を視覚的に確認
- **完全日本語対応**: UI全体が日本語化されており、初心者でも使いやすい
- **豊富な拡張機能**: ゲームモード、ランクシステム、学習記録など
- **カスタマイズ可能**: 単語リストの追加・編集・インポート/エクスポート対応

## 🤖 選べる3つのAIプロバイダー

設定画面から、用途や予算に合わせて判定エンジンを切り替えられます。

### Google Gemini (推奨)
- **特徴**: 高速かつ高精度。マルチモーダルな理解力を活かし、的確なアドバイスを提供
- **コスト**: 無料枠（Free Tier）で十分実用可能
- **取得方法**: [Google AI Studio](https://makersuite.google.com/app/apikey) でAPIキーを取得

### OpenAI (Whisper + GPT-4o-mini)
- **特徴**: 世界最高峰の音声認識モデル「Whisper」による正確な文字起こしと、GPTによる自然なアドバイス
- **コスト**: API利用料が発生（従量課金）
- **取得方法**: [OpenAI Platform](https://platform.openai.com/api-keys) でAPIキーを取得

### Web Speech API (Browser Native)
- **特徴**: ブラウザ内蔵エンジンを使用。APIキー不要・完全無料・爆速
- **注意**: 簡易的な判定となり、アドバイスは汎用的なものになります

## 🌟 主な機能

### 1. 🗣️ 発音練習モード (Speaking Mode)
- **AI発音判定**: 録音した音声をAIが解析し、正誤を判定
- **100点満点スコアリング**: 発音の正確さを数値で評価
- **AIコーチング**: 発音が間違っていた場合、「舌の位置」や「唇の形」について、日本語で具体的なアドバイスをフィードバック
- **発音図解**: 各音素の正しい口の形と舌の位置を視覚的に確認
- **お手本音声再生**: ネイティブスピーカーの発音を聞いて学習
- **SRS (間隔反復学習)**: 苦手な単語を自動的に優先出題し、記憶定着を促します

### 2. 👂 聞き取り練習モード (Listening Mode)
- **クイズ形式**: 流れてくる音声を聞いて、それが「L」の単語か「R」の単語かを選択
- **即座にフィードバック**: 正解・不正解をすぐに確認
- **連続正解カウント**: ストリーク機能でモチベーション向上

### 3. 📊 音声可視化 (Audio Visualizer)
発音時の音声をリアルタイム、および録音後に静止画として分析できます。タップで3つのモードを切り替え可能です。

- **波形 (WAVE)**: 音のリズムや強弱を確認
- **声紋 (SPECTROGRAM)**: **L/R識別の鍵となる第3フォルマント（F3）**の変化を視覚的に確認
- **スペクトル (SPECTRUM)**: 声の高さの成分分布を表示

### 4. 📝 単語リスト管理 (Word Database Manager)
- **カスタマイズ可能**: 独自の単語ペアを追加・編集・削除可能
- **レベル管理**: 複数のレベル（basic, intermediate, advanced, business等）を作成・管理
- **インポート/エクスポート**: JSON形式でデータのバックアップや共有が可能
- **発音データ対応**: 各単語に音素データを設定し、発音図解を表示可能

### 5. 🎮 拡張機能・ゲームモード

#### ⚡ ブリッツモード (Blitz Mode)
- 制限時間30秒内にL/Rを聞き分ける早押しゲーム
- スコアを競いながら集中力を鍛える

#### 🔥 早口言葉チャレンジ (Tongue Twister)
- L/Rを含む難易度別の早口言葉を練習
- 4段階の難易度（Basic → Sentence → Hard → Nightmare）

#### 📝 センテンスモード (Sentence Mode)
- L/Rを含む短文をシャドーイング形式で練習
- 実践的な会話フレーズを学習

#### 🪞 ミラーモード (Mirror Mode)
- Webカメラで自分の口の形をリアルタイム確認
- 発音図解と自分の口を同時に見比べて練習

#### 🎯 フォルマントゲーム (Formant Game)
- F3（第3フォルマント）の変化を視覚的に捉えるゲーム
- 音声分析の理解を深める

#### 🎉 祝賀演出 (Celebration)
- 高得点や連勝時に紙吹雪を舞わせる演出
- 学習のモチベーション向上

#### 🏆 ランクシステム (Rank System)
- 累計正解数（XP）に基づいて称号を獲得
- 8段階のランク（初心者 → 発音神）
- RPG風の成長システムで継続的な学習をサポート

#### 📊 学習記録グラフ
- 日々の学習記録（正解・不正解の数）を棒グラフで表示
- Chart.jsを使用した視覚的な分析

#### 👥 重ね合わせ再生 (Overlap Playback)
- 自分の録音とお手本音声を同時に再生
- リズムやイントネーションのズレを直感的に比較

#### 💡 カタカナヒント
- L/Rの単語に対応するカタカナ表記を自動表示
- 発音のイメージを掴みやすくする

#### 🎭 反応マスコット
- 正解・不正解に反応するアニメーションマスコット
- 楽しく学習を続けられる

### 6. ⚙️ その他の機能
- **自動次へ**: 正解時に自動で次の問題に進む
- **自動停止**: 発音終了を自動検知して録音を停止
- **履歴表示**: 過去の回答履歴を確認
- **ダークモード**: 目に優しいダークテーマ
- **再生速度調整**: お手本音声の再生速度を0.5x〜1.5xで調整
- **iOS最適化**: iOSデバイスでの動作を最適化したパッチ

### 7. 📱 PWA (Progressive Web App) 対応
スマートフォンの「ホーム画面に追加」に対応。ネイティブアプリのようなフルスクリーン体験を提供します。

## 📂 ディレクトリ構成

機能ごとにJSファイルを分割し、カテゴリ別にフォルダ分けすることで、可読性とメンテナンス性を向上させました。

```
.
├── index.html              # エントリーポイント（スクリプト読み込み構成）
├── help.html               # 機能ガイドページ
├── style.css               # スタイルシート
├── data/                   # 単語データセット
│   ├── basic.js            # 初級レベル
│   ├── intermediate.js     # 中級レベル
│   ├── advanced.js         # 上級レベル
│   └── business.js         # ビジネスレベル
└── js/
    ├── loader.js           # スクリプトローダー（読み込み順序管理）
    ├── core/               # コア機能（アプリの基盤）
    │   ├── core_templates.js        # HTMLテンプレート文字列定義
    │   ├── core_logic.js            # アプリの状態管理・初期化・SRSロジック
    │   ├── core_db_manager.js       # DB操作・設定管理
    │   ├── core_audio_visuals.js    # 音声可視化 (Canvas, Web Audio API)
    │   ├── core_api_client.js       # API通信 (Gemini, OpenAI, Web Speech)
    │   ├── core_app_flow.js         # UIインタラクション・録音フロー制御
    │   ├── core_dom_events.js       # DOMイベントハンドラ
    │   └── core_ui_components.js    # DOM生成・注入ロジック
    ├── features/           # 拡張機能（オプション機能）
    │   ├── feature_extensions.js        # 学習記録・グラフ化
    │   ├── feature_scoring.js           # AIスコアリング（100点満点）
    │   ├── feature_overlay_playback.js  # 重ね合わせ再生
    │   ├── feature_help_link.js         # ヘルプリンク
    │   ├── feature_formant_game.js      # フォルマントゲーム
    │   ├── feature_mirror_mode.js       # ミラーモード（Webカメラ）
    │   ├── feature_blitz_mode.js        # ブリッツモード（早押しゲーム）
    │   ├── feature_tongue_twister.js    # 早口言葉チャレンジ
    │   ├── feature_celebration.js       # 祝賀演出（紙吹雪）
    │   ├── feature_rank_system.js       # ランクシステム（RPG風）
    │   ├── feature_katakana_hint.js     # カタカナヒント
    │   ├── feature_sentence_mode.js     # センテンスモード
    │   └── feature_reaction_mascot.js   # 反応マスコット
    └── utils/              # ユーティリティ（補助機能）
        ├── util_settings_organizer.js   # 設定画面の整理整頓
        ├── util_ios_mic_fix.js          # iOSマイク修正パッチ
        └── util_ios_scroll_fix.js       # iOSスクロール修正パッチ
```
## 🛠️ 技術スタック

### Frontend
- **HTML5, CSS3**: モダンなWeb標準
- **Vanilla JavaScript**: フレームワーク不要の軽量実装
- **ES6+**: モジュール構造を模したコード分割

### AI API
- **Google Gemini API**: Flash / Pro モデル対応
- **OpenAI API**: Whisper-1（音声認識）+ GPT-4o-mini（アドバイス生成）
- **Web Speech API**: ブラウザ標準の音声認識・合成

### Browser APIs
- **Web Audio API**: スペクトル分析、音声可視化
- **Web Speech API**: 音声認識・テキスト読み上げ
- **MediaRecorder API**: 音声録音
- **MediaDevices API**: マイク・カメラアクセス

### データストレージ
- **LocalStorage**: 設定・単語リスト・学習記録の保存

### 外部ライブラリ
- **Chart.js**: 学習記録のグラフ表示

## ⚙️ セットアップと使用方法

### デプロイ
静的ファイルのみで構成されているため、GitHub PagesやNetlify等にアップロードするだけで動作します。

### APIキーの設定
1. アプリ右上の「⚙️ (設定)」ボタンを開きます
2. **AIプロバイダー**を選択します
3. 利用するサービスのAPIキーを入力します
   - **Gemini**: [Google AI Studio](https://makersuite.google.com/app/apikey) で取得
   - **OpenAI**: [OpenAI Platform](https://platform.openai.com/api-keys) で取得
   - **Web Speech**: キー入力不要ですぐに使えます
4. Gemini選択時は「🔄 Geminiモデルを更新」を押してモデルリストを取得してください
5. 「設定を保存」ボタンをクリック

### 基本的な使い方
1. **モード選択**: 画面上部で「🎤 発音」または「👂 聞き取り」モードを選択
2. **レベル選択**: プルダウンから学習したいレベルを選択
3. **発音モードの場合**:
   - 表示された単語を確認
   - 音素ボタンを押して発音のコツを確認
   - 「🎤 開始」ボタンを押して発音
   - AIの判定とアドバイスを確認
4. **聞き取りモードの場合**:
   - 「🔊 再生」ボタンで音声を再生
   - 「L」または「R」ボタンで回答
   - 正解・不正解を確認

### 拡張機能の有効化
設定画面から各拡張機能をオン/オフできます。必要に応じて有効化してください。

## 📚 関連ドキュメント

詳細な機能説明は [help.html](help.html) をご覧ください。

## 🔄 バージョン情報

現在のバージョン: **v2.4.0**

### 主な変更履歴
- **v2.4.0**: フォルダ構成の整理、日本語化の完了
- **v2.x**: モジュラー構成へのリファクタリング、拡張機能の追加
- **v1.x**: 初期リリース

## 📄 ライセンス

This project is open source and available under the MIT License.

## 🤝 コントリビューション

バグ報告や機能要望は、GitHubのIssuesでお知らせください。プルリクエストも歓迎します。

## 📧 お問い合わせ

質問やサポートが必要な場合は、GitHubのIssuesでお気軽にお問い合わせください。